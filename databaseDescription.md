C'est une mise √† jour tr√®s compl√®te et pr√©cise qui rapproche votre base de donn√©es d'un syst√®me E-commerce professionnel (type Shopify ou Take.app). Le fait de lier un client √† un seul magasin simplifie la gestion de la confidentialit√© pour chaque commer√ßant (silo de donn√©es).

Voici le Mod√®le Conceptuel de Donn√©es (MCD) adapt√© pour Supabase (PostgreSQL), int√©grant toutes vos nouvelles sp√©cifications.

1. Diagramme Relationnel (Visuel)
Ce sch√©ma montre comment les tables interagissent. Notez la hi√©rarchie : Entreprise -> Magasin -> Produits/Clients.

Extrait de code

erDiagram
    %% GESTION DES UTILISATEURS (Supabase Auth)
    AUTH_USER ||--|| ENTERPRISE : "g√®re"

    %% STRUCTURE COMMERCIALE
    ENTERPRISE ||--|{ STORE : "poss√®de"
    
    ENTERPRISE {
        uuid id PK
        uuid owner_id FK
        string name
        timestamp created_at
    }

    STORE {
        uuid id PK
        uuid enterprise_id FK
        string name
        string slug "URL unique"
        string phone
        string image_url
        string color_theme
    }

    %% GESTION CATALOGUE
    STORE ||--|{ CATEGORY : "d√©finit"
    STORE ||--|{ TAG : "utilise"
    STORE ||--|{ PRODUCT : "vend"
    
    CATEGORY {
        bigint id PK
        uuid store_id FK
        string name
    }

    TAG {
        bigint id PK
        uuid store_id FK
        string name
    }

    PRODUCT {
        bigint id PK
        uuid store_id FK
        bigint category_id FK
        string name
        enum type "Physique, Num√©rique..."
        string sku
        numeric price
        numeric original_price
        boolean show_estimated_price
        boolean track_cost
        numeric cost_per_item
        boolean show_net_price
        numeric unit_value
        enum unit_type "KG, L, PCS..."
        boolean tax_exempt
        text tax_exempt_reason
        text description
        jsonb images "Tableau d'URLs"
        boolean requires_shipping
        text[] delivery_methods "Emporter, Livraison..."
        boolean is_visible
        boolean is_out_of_stock
        boolean track_inventory
        int stock_quantity
        int daily_capacity
        int max_order_qty
        int min_order_qty
    }

    %% RELATIONS PRODUITS AVANC√âES
    PRODUCT }|--|{ TAG : "est √©tiquet√©"
    PRODUCT ||--|{ VARIANT : "poss√®de"
    PRODUCT ||--|{ OPTION : "propose"

    VARIANT {
        bigint id PK
        bigint product_id FK
        string name
        numeric price
        numeric original_price
        string image_url
    }

    OPTION {
        bigint id PK
        bigint product_id FK
        string name
        enum type "Texte, Date, Select..."
        jsonb values "Choix possibles"
        boolean is_required
    }

    %% GESTION CLIENTS (CRM)
    STORE ||--|{ CLIENT : "fid√©lise"
    
    CLIENT {
        uuid id PK
        uuid store_id FK
        string name
        string phone
        string email
        date birthday
        text address
        text notes
        string referral_code
    }

    CLIENT }|--|{ TAG : "a des √©tiquettes"
2. Code SQL pour Supabase (Impl√©mentation)
Copiez-collez ce code dans l'√©diteur SQL de votre tableau de bord Supabase pour cr√©er toute la structure d'un coup. J'ai utilis√© des types ENUM pour s√©curiser les listes de choix (Unit√©s, Types).

SQL

-- 1. Cr√©ation des Types ENUM (Listes de choix fixes)
CREATE TYPE product_type_enum AS ENUM ('physique', 'numerique', 'reservation', 'abonnement', 'autres');
CREATE TYPE unit_type_enum AS ENUM ('G', 'KG', 'L', 'ML', 'PCS', 'PAX', 'PERSON', 'ROOM', 'PACK', 'QTY', 'LBS', 'HOUR', 'BOX');
CREATE TYPE option_type_enum AS ENUM ('text', 'number', 'date', 'checkbox', 'select');
CREATE TYPE delivery_method_enum AS ENUM ('emporter', 'livraison', 'sur_place');

-- 2. Table ENTREPRISE (Li√©e au user Supabase)
CREATE TABLE enterprises (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    owner_id UUID REFERENCES auth.users(id) NOT NULL,
    name TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3. Table MAGASIN (Stores)
CREATE TABLE stores (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    enterprise_id UUID REFERENCES enterprises(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    slug TEXT UNIQUE NOT NULL, -- Pour l'URL (ex: wa-shop.cm/mon-shop)
    image_url TEXT,
    phone TEXT,
    color TEXT DEFAULT '#25D366', -- Couleur de la boutique
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 4. Table CATEGORIES
CREATE TABLE categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id UUID REFERENCES stores(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 5. Table TAGS (Etiquettes partag√©es Produits et Clients)
CREATE TABLE tags (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id UUID REFERENCES stores(id) ON DELETE CASCADE,
    name TEXT NOT NULL
);

-- 6. Table PRODUITS (Products)
CREATE TABLE products (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    store_id UUID REFERENCES stores(id) ON DELETE CASCADE,
    category_id BIGINT REFERENCES categories(id) ON DELETE SET NULL,
    
    -- Infos de base
    name TEXT NOT NULL,
    type product_type_enum DEFAULT 'physique',
    sku TEXT, -- UGS
    description TEXT,
    images JSONB, -- Stockera un tableau d'URLs ex: ["url1.jpg", "url2.jpg"]
    tags_list JSONB, -- Ou utiliser une table de liaison, ici simple tableau d'IDs de tags

    -- Prix et Co√ªts
    price NUMERIC NOT NULL DEFAULT 0,
    original_price NUMERIC, -- Prix barr√©
    show_estimated_price BOOLEAN DEFAULT FALSE,
    track_cost BOOLEAN DEFAULT FALSE, -- Co√ªt par article (bool)
    cost_price NUMERIC, -- Prix par article (valeur)
    show_net_price BOOLEAN DEFAULT FALSE, -- Prix net par unit√© visible

    -- Unit√©s et Mesures
    unit_value NUMERIC,
    unit unit_type_enum DEFAULT 'PCS',
    
    -- Fiscalit√©
    tax_exempt BOOLEAN DEFAULT FALSE, -- D√©rogation fiscale
    tax_exempt_reason TEXT, -- Valeur de la d√©rogation
    
    -- Logistique
    requires_shipping BOOLEAN DEFAULT TRUE, -- Livraison
    delivery_methods TEXT[], -- Tableau: ['emporter', 'livraison']
    
    -- Gestion Stock et Visibilit√©
    is_visible BOOLEAN DEFAULT TRUE,
    is_out_of_stock BOOLEAN DEFAULT FALSE, -- Marquer comme √©puis√©
    track_inventory BOOLEAN DEFAULT FALSE, -- Quantit√© de voies (suivi stock)
    stock_quantity INTEGER DEFAULT 0, -- Valeur num√©rique du stock
    daily_capacity INTEGER, -- Pour les r√©servations
    max_order_quantity INTEGER,
    min_order_quantity INTEGER DEFAULT 1,
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 7. Table VARIANTES (Variants)
CREATE TABLE variants (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT REFERENCES products(id) ON DELETE CASCADE,
    name TEXT NOT NULL, -- ex: "Rouge / XL"
    price NUMERIC NOT NULL,
    original_price NUMERIC,
    image_url TEXT
);

-- 8. Table OPTIONS (Pour la personnalisation client)
CREATE TABLE options (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    product_id BIGINT REFERENCES products(id) ON DELETE CASCADE,
    name TEXT NOT NULL, -- ex: "Gravure sur le produit"
    type option_type_enum DEFAULT 'text',
    values JSONB, -- Liste des choix si type='select' (ex: ["Rouge", "Bleu"])
    is_required BOOLEAN DEFAULT FALSE
);

-- 9. Table CLIENTS (Isol√©s par magasin)
CREATE TABLE clients (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    store_id UUID REFERENCES stores(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    phone TEXT NOT NULL, -- T√©l√©phone principal
    alt_phone TEXT, -- Num√©ro de t√©l√©phone (secondaire)
    email TEXT,
    birthday DATE,
    address TEXT,
    notes TEXT,
    referral_code TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 10. Table Liaison CLIENTS <-> TAGS
CREATE TABLE client_tags (
    client_id UUID REFERENCES clients(id) ON DELETE CASCADE,
    tag_id BIGINT REFERENCES tags(id) ON DELETE CASCADE,
    PRIMARY KEY (client_id, tag_id)
);

-- 11. Table Liaison PRODUITS <-> TAGS
CREATE TABLE product_tags (
    product_id BIGINT REFERENCES products(id) ON DELETE CASCADE,
    tag_id BIGINT REFERENCES tags(id) ON DELETE CASCADE,
    PRIMARY KEY (product_id, tag_id)
);
3. Explications des Choix Techniques
Gestion des Types et Unit√©s (ENUM) : Plut√¥t que de stocker du texte libre qui peut causer des erreurs (ex: "kg", "Kg", "Kilo"), j'ai cr√©√© des listes strictes (unit_type_enum) correspondant exactement √† votre demande (G, KG, L, etc.).

Images (JSONB) : Pour les produits qui ont plusieurs images, Supabase g√®re tr√®s bien le format JSON. Cela √©vite de cr√©er une table images s√©par√©e.

Livraison (TEXT[]) : Le champ delivery_methods est un tableau de texte. Cela permet √† un produit d'√™tre √† la fois "√Ä emporter" ET "Livraison" (choix multiple).

Clients Isol√©s : La table clients contient store_id. Si "Jean" ach√®te dans la Boutique A et la Boutique B, il aura deux lignes diff√©rentes dans la base. Cela respecte votre r√®gle "un client est li√© √† un seul magasin".

Co√ªt par article : J'ai s√©par√© le bool√©en (track_cost) de la valeur (cost_price) pour une meilleure logique applicative.

C'est une structure tr√®s solide pour d√©marrer votre d√©veloppement. Voulez-vous que je pr√©pare les Politiques de S√©curit√© (RLS) pour ces tables ?



# üìã R√©capitulatif Complet des Tables du MCD - Wa-Shop Cameroun

Ce document liste toutes les tables du Mod√®le Conceptuel de Donn√©es (MCD), leurs champs principaux, leurs relations (cl√©s √©trang√®res - FK) et leur r√¥le dans le syst√®me multi-boutiques.

**Base de Donn√©es :** PostgreSQL (via Supabase)
**Authentification :** `auth.users`

---

## 1. üè¢ Tables Structurelles (Compte et Magasin)

| Table | R√¥le | Colonne Cl√© | Description des Colonnes Importantes |
| :--- | :--- | :--- | :--- |
| **enterprises** | Repr√©sente l'entit√© juridique/commerciale (li√© √† l'utilisateur `auth`). | `id` (PK), `owner_id` (FK) | `name` (Nom de l'entreprise), `client` (Champ demand√©), `owner_id` (Lien vers `auth.users`). |
| **stores** | Le magasin/la boutique. L'entit√© principale isolant les donn√©es. | `id` (PK), `enterprise_id` (FK) | `name`, **`slug` (UNIQUE, URL de la boutique)**, `phone` (WhatsApp), `image_url` (Logo), `color` (Th√®me). |

---

## 2. üõçÔ∏è Tables du Catalogue (Produits et Organisation)

| Table | R√¥le | Colonne Cl√© | Description des Colonnes Importantes |
| :--- | :--- | :--- | :--- |
| **categories** | Organisation du catalogue (ex: Boissons, P√¢tisseries). | `id` (PK), `store_id` (FK) | `name`. |
| **tags** | √âtiquettes pour produits et clients (ex: Promo, VIP). | `id` (PK), `store_id` (FK) | `name`. |
| **products** | L'entit√© produit principale. | `id` (PK), `store_id` (FK) | `category_id` (FK), `name`, `type` (`ENUM`), **`sku` (UGS)**, `price`, `original_price`, `stock_quantity`, `is_visible`. |
| **variants** | D√©clinaisons d'un produit (taille, couleur). | `id` (PK), `product_id` (FK) | `name`, `price`, `image_url`. |
| **options** | Personnalisation du produit (ex: Texte √† graver). | `id` (PK), `product_id` (FK) | `name`, `type` (`ENUM`), `values` (JSONB des choix possibles), `is_required`. |

---

## 3. üéØ Tables CRM (Gestion des Clients)

| Table | R√¥le | Colonne Cl√© | Description des Colonnes Importantes |
| :--- | :--- | :--- | :--- |
| **clients** | Fiche client isol√©e par magasin (CRM). | `id` (PK), `store_id` (FK) | `name`, `phone`, `email`, `birthday`, `address`, `notes` (pour le commer√ßant), `referral_code`. |
| **client_tags** | Table de liaison : Un client peut avoir plusieurs tags. | `client_id` (PK, FK), `tag_id` (PK, FK) | Permet la relation Many-to-Many entre `clients` et `tags`. |
| **product_tags** | Table de liaison : Un produit peut avoir plusieurs tags. | `product_id` (PK, FK), `tag_id` (PK, FK) | Permet la relation Many-to-Many entre `products` et `tags`. |

---

## 4. üõí Tables Transactionnelles et Logistiques

| Table | R√¥le | Colonne Cl√© | Description des Colonnes Importantes |
| :--- | :--- | :--- | :--- |
| **orders** | Enregistrement de la commande (pour le dashboard `/admin/orders`). | `id` (PK), `store_id` (FK) | `customer_name`, `customer_phone`, `delivery_address`, **`total_amount`**, `delivery_fee`, **`status` (`ENUM`)**, `whatsapp_message` (log du message envoy√©). |
| **order_items** | D√©tail des produits d'une commande. | `id` (PK), `order_id` (FK) | `product_id` (FK), `variant_id` (FK, optionnel), **`unit_price`** (prix au moment de l'achat), `quantity`. |
| **delivery_zones** | Configuration des frais de livraison. | `id` (PK), `store_id` (FK) | `name` (Quartier/Zone), `base_fee`, `min_order_for_free`. |

---

## 5. üìà Tables d'Analyse (Statistiques)

| Table | R√¥le | Colonne Cl√© | Description des Colonnes Importantes |
| :--- | :--- | :--- | :--- |
| **analytics_log** | Enregistrement des √©v√©nements cl√©s (pour le dashboard `/admin/stats`). | `id` (PK), `store_id` (FK) | **`event_type` (`ENUM`)** (ex: `whatsapp_click`, `product_view`), `resource_id` (ID du produit ou de la commande), `ip_address`. |

---

## 6. üîó R√©f√©rences de Types de Donn√©es (ENUMs)

| Nom du Type | Valeurs Possibles | Utilisation dans la Table |
| :--- | :--- | :--- |
| **product_type_enum** | `physique`, `numerique`, `reservation`, `abonnement`, `autres` | `products.type` |
| **unit_type_enum** | `G`, `KG`, `L`, `ML`, `PCS`, `PAX`, `PERSON`, `ROOM`, `PACK`, `QTY`, `LBS`, `HOUR`, `BOX` | `products.unit` |
| **option_type_enum** | `text`, `number`, `date`, `checkbox`, `select` | `options.type` |
| **delivery_method_enum** | `emporter`, `livraison`, `deguster_sur_place` | `products.delivery_methods` (Array) |
| **order_status_enum** | `new`, `sent_to_whatsapp`, `processing`, `completed`, `cancelled` | `orders.status` |
| **event_type_enum** | `page_view`, `product_view`, `add_to_cart`, `whatsapp_click`, `order_generated` | `analytics_log.event_type` |